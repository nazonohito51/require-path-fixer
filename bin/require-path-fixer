#!/usr/bin/env php
<?php
include_once getcwd() . '/vendor/autoload.php';

$dir = null;
$requireBase = null;
$constant = null;
$isReport = false;

$arguments = $_SERVER['argv'];
array_shift($arguments);
foreach ($arguments as $argument) {
    if ($argument == '--report') {
        $isReport = true;
    } elseif (is_null($dir)) {
        $dir = realpath(getcwd() . '/' . $argument);
    } elseif (is_null($requireBase)) {
        $requireBase = realpath(getcwd() . '/' . $argument);
    } else {
        $constant = $argument;
    }
}

if (is_null($dir) || is_null($requireBase) || $dir == false || $requireBase == false) {
    var_dump(getcwd());
    var_dump($dir);
    var_dump($requireBase);
    throw new InvalidArgumentException();
} elseif ($isReport) {
    $fixer = new \RequirePathFixer\Fixer($dir);
    $fixer->report($requireBase, $constant);
} else {
    $fixer = new \RequirePathFixer\Fixer($dir);
    $fixer->fix($requireBase, $constant);
}
